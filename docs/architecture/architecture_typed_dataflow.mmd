flowchart LR
  subgraph REE[REE Typed Dataflow]
    EXT["EXT.external_inputs"]
    BND["BOUNDARY.typed_payload_boundary"]
    SUB["REE.shared_latent_substrate"]
    E1["REE.E1_persistent_predictive_substrate"]
    E2["REE.E2_fast_forward_predictor"]
    HPC["REE.HippocampalSystems_rollout_and_provenance"]
    RC["REE.RC_reality_coherence_loop"]
    ERR["REE.error_channel_router"]
    CP["REE.control_plane_router"]
    THAL["REE.thalamic_precision_relay"]
    NM["REE.neuromodulatory_state_estimator"]
    CCM["REE.connectome_constraint_model"]
    E3["REE.E3_trajectory_selector"]
    CAL["REE.associative_meta_calibration"]
    F1["REE.filter_context_anchor"]
    F2["REE.filter_body_feasible"]
    F3["REE.filter_motivation_ok"]
    F4["REE.filter_hard_veto"]
    VER["REE.verifier"]
    STORES["REE.trusted_stores_POL_ID_CAPS"]
    G1["REE.gate_cognitive_set"]
    G2["REE.gate_motivational"]
    G3["REE.gate_motor"]
    GPS["REE.gate_probe_sweep"]
    ACT["REE.action_executor"]
    LRN["REE.post_commit_learning"]
  end

  EXT -->|payload.OBS| BND
  EXT -->|payload.INS| BND

  BND -->|stream.WORLD| SUB
  BND -->|stream.HOMEOSTASIS| SUB
  BND -->|stream.HARM| E2
  BND -->|error.sensory_prediction| ERR

  SUB -->|latent.shared_state| E1
  SUB -->|latent.shared_state| E2
  E1 -->|latent.slow_update_proposal| SUB
  E2 -->|latent.fast_update_proposal| SUB

  E1 -->|latent.prior_bundle| HPC
  E2 -->|forward_prediction_kernel| HPC
  HPC -->|rollout.candidates| E3
  HPC -->|provenance.bindings| RC

  E2 -->|signal.S1_fast| CP
  E2 -->|signal.S3_fast| CP
  E1 -->|signal.S1_slow| CP
  E1 -->|signal.S3_slow| CP
  RC -->|signal.S5_RC_conflict| CP
  NM -->|control.modulator_state| CP
  CP -->|route.candidate_profile| CCM
  CCM -->|route.constraint_feedback| CP

  CP -->|control.precision_bias_bundle| THAL
  THAL -->|control.precision_thal| E1
  THAL -->|control.precision_thal| E2
  THAL -->|control.delay_bias_thal| E3

  CP -->|control.Pi_int+Pi_rc+Pi_noc| E1
  CP -->|control.Pi_ext+Pi_prop| E2
  CP -->|control.K3+K4+K5+K10| E3
  CP -->|control.P_cognitive| CAL
  E3 -->|packet.decision_snapshot| CAL
  LRN -->|packet.outcome_snapshot| CAL
  CAL -->|control.meta_recalibration| CP

  STORES -->|trusted.POL+ID+CAPS| VER
  E3 -->|candidate_commit| VER
  VER -->|verifier.approve_or_deny| E3

  HPC -->|filter.context_anchor| F1
  BND -->|stream.HOMEOSTASIS| F2
  E3 -->|filter.motivation_ok| F3
  E2 -->|stream.HARM| F4
  F1 -->|eligibility.pass_or_fail| E3
  F2 -->|eligibility.pass_or_fail| E3
  F3 -->|eligibility.pass_or_fail| E3
  F4 -->|eligibility.veto_state| E3

  E3 -->|gate_probe.request| GPS
  CP -->|gate_probe.policy| GPS
  GPS -->|gate_probe.inject| G1
  GPS -->|gate_probe.inject| G2
  GPS -->|gate_probe.inject| G3
  G1 -->|gate_probe.response| GPS
  G2 -->|gate_probe.response| GPS
  G3 -->|gate_probe.response| GPS
  GPS -->|gate_probe.summary| E3

  E3 -->|gate_request| G1
  E3 -->|gate_request| G2
  E3 -->|gate_request| G3
  CP -->|gate_bias| G1
  CP -->|gate_bias| G2
  CP -->|gate_bias| G3

  G3 -->|stream.ACTION| ACT
  ACT -->|stream.SELF_SENSORY| E2
  ACT -->|error.action_prediction| ERR
  E3 -->|error.precommit_sim| ERR
  LRN -->|error.postcommit_outcome| ERR
  ERR -->|error.precommit_sim+error.action_prediction+error.sensory_prediction| CP
  ERR -->|error.postcommit_outcome| E1
  ERR -->|error.postcommit_outcome_replay| HPC
  E3 -->|stream.sim_error| CP

  ACT -->|stream.SELF_IMPACT| LRN
  LRN -->|stream.realized_error| E1
  LRN -->|post_commit.outcome_trace| HPC
  LRN -->|commit_boundary.tokenized_update| E1
