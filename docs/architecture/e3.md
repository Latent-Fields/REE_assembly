# E3 — Trajectory Selection and Commitment Engine

**Claim Type:** architectural_commitment  
**Scope:** Trajectory selection, commitment, and temporal collapse mechanism  
**Depends On:** INV-012 (commitment gates responsibility), [E1](e1.md), [E2](e2.md), [L-space](l_space.md), [residue geometry](residue_geometry.md), [precision control](control_plane.md)  
**Status:** stable  
**Claim ID:** ARC-003
<a id="arc-003"></a>

---

E3 is the component of the Reflective Ethical Engine (REE) responsible for selecting, stabilising, and committing a trajectory through a temporally displaced latent space.  
It is the mechanism by which prediction becomes lived experience.

E3 does **not** select instantaneous actions or perceptual states.  
It selects *trajectories* and determines whether a unitary present (“now”) is constructed at all.

**Subsystem abstract (core claims):** ARC‑003 defines trajectory selection and commitment. Supporting context includes
INV‑012 (commitment gates responsibility), ARC‑004 (latent stack), ARC‑005 (precision control), ARC‑012 (legacy ethical
term note), ARC‑018 (rollout source for candidates), MECH‑060 (dual pre/post-commit error channels), and
MECH‑061/MECH‑062 (commit-boundary token + tri-loop commitment gating).

---

## 1. Architectural role

E3 sits downstream of predictive generation (E1, E2) and upstream of action, memory consolidation, and subjective experience.

Its core functions are:

- Selection of a coherent trajectory across predictive depths
- Conditional commitment to that trajectory
- Temporal collapse of displaced predictions into an experienced present
- Enforcement of perceptual corrigibility and ethical constraint

E3 operates only when licensed by global viability and attention signals (see Precision Control).

---

## 2. Inputs and outputs (interface contract)

### Inputs

E3 receives:

- A **temporally displaced latent bundle**  
  \( \mathcal{B}_t = \{ \hat z_k(t+\Delta) \}_{k \in K} \)  
  (see `latent_stack.md`)

- A **precision profile**  
  \( \alpha = \{ \alpha_k \}_{k \in K} \)  
  (see `precision_control.md`)

- A **residue / ethical curvature field**  
  \( \mathcal{R}(\cdot) \)  
  (see `residue_geometry.md`)

- Feasibility and invariant constraints  
  (dynamics, safety, care budget)

- Global affective / viability signals  
  (reward, harm, uncertainty tolerance, kin relevance)

### Outputs

E3 emits:

- A selected trajectory \( \tau^\* \) (or null)
- A **commitment signal**
- Precision escalation or suppression directives
- Action gating / policy parameters
- Intended-action labels for self-impact attribution (feeds post-action comparison)
- Memory write-enable signals

---

## 3. What E3 selects

A **trajectory** \( \tau \) is a path through the displaced latent bundle over a horizon \(H\):

\[
\tau = \big(
a_{t:t+H},
\hat z_{K,\,t:t+H},
\hat o_{t:t+H}
\big)
\]

Trajectories may be generated by:
- fast predictor forward predictions (affordance-level kernels)
- deep predictor forward predictions (narrative / workspace constraints)
- hippocampal replay and braid mechanisms

**Canonical clarification (2026-02-09):** explicit multi-step rollouts are generated by hippocampal systems.
References to fast/deep rollouts should be read as **inputs and constraints** from E2/E1 that seed hippocampal
trajectory generation, not separate rollout engines. E3 does not imagine; it selects and commits.

---

## 4. Selection functional (symbolic)

E3 selects the trajectory that minimises a composite energy functional:

\[
\tau^\* =
\arg\min_{\tau \in \Omega}
\Big[
\lambda_C\,\mathcal{C}(\tau;\alpha)
+ \lambda_R\,\mathcal{R}(\tau)
+ \lambda_F\,\mathcal{F}(\tau)
- \lambda_I\,\mathcal{I}(\tau)
+ \lambda_P\,\mathcal{P}(\tau)
\Big]
\]

Where:

- \( \mathcal{C}(\tau;\alpha) \) — cross-horizon coherence cost  
- \( \mathcal{R}(\tau) \) — residue / ethical curvature cost  
- \( \mathcal{F}(\tau) \) — feasibility and control cost  
- \( \mathcal{I}(\tau) \) — epistemic value (exploration benefit)  
- \( \mathcal{P}(\tau) \) — phase-lock / temporal collapse penalty  

The coefficients \( \lambda \) are modulated by precision and affective state.

---

## 4a. Ethical Cost Term (Legacy vs Current)

<a id="arc-012"></a>
**Claim ID:** ARC-012

Current canonical framing: E3 selection does not require an explicit ethical cost term. Ethical consequence is encoded via residue curvature, mirror modelling, and commitment-gated learning rather than a separate moral module or cost term.

Legacy formulations included an explicit ethical cost term \(M\) in trajectory scoring. That wording is preserved in processed sources and is no longer canonical.

Source: `docs/processed/legacy_tree/REE_CORE.md`

---

## 5. Coherence and depth interaction

Coherence is evaluated both:

- **Within depth**: prediction error weighted by precision
- **Across depth**: agreement between projected representations at different horizons

Deep regime predictors (reward, threat, attachment) bias selection *via precision and scoring*, not semantic overwrite, preserving perceptual corrigibility.

---

## 6. Commitment and temporal collapse

E3 operates in two regimes:

### Exploratory regime
- Multiple trajectories evaluated
- Low action-depth precision
- No phase-locking to motor execution
- No unitary present constructed  
  (see `Default_mode.md`)

### Committed regime
- A single trajectory is stabilised
- Action-depth precision is increased
- Predictions are phase-aligned with motor timing
- A unitary present (“now”) is constructed

Commitment is triggered when a trajectory is:
- sufficiently coherent,
- ethically admissible,
- feasible,
- and licensed by global viability signals.

---

<a id="mech-061"></a>
## Commit-Boundary Token and Error Reclassification (MECH-061)

**Claim Type:** mechanism_hypothesis  
**Scope:** Explicit boundary token that separates pre-commit and post-commit error classes  
**Depends On:** ARC-003, MECH-060, INV-012, ARC-015  
**Status:** candidate  
**Claim ID:** MECH-061

E3 should emit an explicit **commit-boundary token** at threshold crossing. The token is the minimal routing primitive
that reclassifies errors from counterfactual evaluation into attributable post-commit feedback.

Minimal token fields (v1 draft):

- `commit_id` (unique id for the commitment event)
- `trajectory_id` (selected trajectory)
- `trajectory_hash` (stable digest of selected trajectory materialization)
- `issued_at_step` (time index at threshold crossing)
- `ttl_steps` (how long downstream attribution may bind to this commit)
- `mode_snapshot` (control-plane mode at commit time)
- `intended_action_labels` (declared intervention labels for attribution joins)
- `authority_path` (resolved authority chain used for this commit)
- `policy_hash` (policy/invariant store digest at commit)
- `caps_hash` (capability/permission manifest digest at commit)
- `verifier_result_hash` (digest of verifier artifact set)
- `uncertainty_snapshot` (compressed uncertainty calibration state at commit boundary)

Routing rule:

- before token issuance: errors are **pre-commit** (`counterfactual`, `coherence`, `effort/conflict`, `anticipated value`)
- after token issuance (within `ttl_steps`): errors are **post-commit** (`reafference mismatch`, `realized outcome`,
  `credit assignment`)

This preserves INV-012 by making responsibility arise at commitment, not at simulation time.

---

<a id="mech-062"></a>
## Tri-Loop Commitment Gating (MECH-062)

**Claim Type:** mechanism_hypothesis  
**Scope:** Three commitment gates (motor, cognitive-set, motivational) with shared thresholding and coordinated arbitration  
**Depends On:** ARC-003, ARC-005, MECH-061  
**Status:** candidate  
**Claim ID:** MECH-062

E3 should expose three coupled commitment gates rather than one global gate:

1. `gate_motor` (movement/action release)
2. `gate_cognitive_set` (task-set/update release)
3. `gate_motivational` (salience/drive release)

The thresholding algorithm is shared, but each gate consumes a different proposal manifold and can be modulated
independently by the control plane. This prevents pathological global coupling where one suppressed stream forces all
streams into suppression.

Loop policy contract:

- `gate_motor`:
  - commit criterion prioritizes trajectory feasibility/integrity.
  - strongest veto power when invariant risk is high.
- `gate_cognitive_set`:
  - commit criterion prioritizes task-set coherence and switching cost.
  - can defer commitment while preserving rehearsal breadth.
- `gate_motivational`:
  - commit criterion prioritizes salience/value lane selection and persistence.
  - may pre-filter proposal bands before full trajectory expansion.

Trajectory-first is therefore loop-specific: strict for motor enactment, softer for cognitive-set updates, and
band-limited for motivational gating.

Coordination invariant:

- conflict across gates must resolve through explicit arbitration policy and be recorded against a `commit_id`, rather
  than via silent dominance of one gate.

Learning/update invariant:

- pre-commit gate activity may tune lane-local thresholds only.
- durable cross-lane policy or ledger writes require commit-boundary transition (MECH-061/060).

### Layered eligibility refinement (implementation-facing)

Tri-loop gating should be implemented as **ordered eligibility filters**, not as a scalar vote among lanes.
Recommended dominance order:

1. hard veto / fast threat interrupt (`HARM`, catastrophic risk),
2. authority and reality-coherence eligibility (verifier + `RC_conflict` posture),
3. contextual anchoring / provenance validity,
4. embodiment/homeostasis feasibility,
5. motivational sufficiency and delay-cost posture,
6. motor release (`gate_motor`) with commit-token issuance.

This keeps "can execute" and "may execute" distinct, and prevents cases where motivational pressure outvotes authority
or safety constraints.

### Evolutionary-constraint note

The disinhibitory commit pattern (default suppression, release-on-selection, opponent promotion/suppression channels)
is treated as a robust computational prior for REE commitment, with cortical/hippocampal systems enriching candidate
generation rather than replacing the gating core.

---

## Implementation Gaps (Open, from 2026-02-15 refresh)

The commit-boundary and tri-loop framing is now canonical, but the following implementation contracts remain open and
should be treated as explicit engineering gaps:

1. Commit-token wire format and routing scope are underspecified beyond the v1 field draft.
2. Cross-gate conflict arbitration policy is underspecified when motor, cognitive-set, and motivational gates disagree.
3. Post-commit credit-assignment interface is underspecified (mask types, causal assumptions, and update timescales).
4. Responsibility locus storage is underspecified (`attribution ledger` vs `training-signal router` vs `stable self-model`).

These gaps should be resolved in implementation-facing specs before promoting MECH-061/MECH-062 beyond candidate.

---

## 7. Precision as control

Precision does not merely tune learning rates.  
It controls whether temporal collapse occurs at all.

- High action-depth precision → lived present
- Balanced precision → sustained exploration
- Misallocated precision → fragmentation or pathological collapse

(see `precision_control.md`)

---

## 8. Failure regimes (E3 pathologies)

Misconfiguration of E3 yields characteristic failure modes:

- **Over-commitment**  
  Excessive temporal collapse → mania, compulsivity

- **Under-commitment**  
  Failure to collapse → indecision, apathy

- **Fragmentation**  
  Competing trajectories → panic, dissociation

- **False coherence**  
  Deep regime overwrite → psychosis-like states

These are architectural regime failures, not simple parameter errors.

---

## 9. Summary

E3 is the engine that turns prediction into experience.

It:
- selects trajectories, not moments,
- constructs the present conditionally,
- enforces ethical and perceptual constraint,
- and grounds selfhood in the sustained act of commitment under uncertainty.

Without E3, REE predicts.
With E3, REE lives.

---

## Open Questions

<a id="q-015"></a>
### Q-015: What is the smallest commit-boundary token that still supports reliable multi-timescale attribution?

- Open design dimensions: token scope, TTL policy, and cross-module broadcast rules.
- Current hard floor candidate fields: `commit_id`, `trajectory_hash`, `authority_path`, `policy_hash`, `caps_hash`,
  `verifier_result_hash`, `uncertainty_snapshot`.
- Anchor: `MECH-061`.

<a id="q-016"></a>
### Q-016: What arbitration policy best resolves cross-gate conflicts (motor vs cognitive-set vs motivational) without coupling collapse?

- Candidate families: veto lattice, weighted arbitration, or mode-dependent precedence.
- Anchor: `MECH-062`.

## Related Claims (IDs)

- ARC-003
- ARC-012
- ARC-001
- ARC-002
- ARC-004
- ARC-005
- INV-012
- ARC-018
- ARC-015
- MECH-060
- MECH-061
- MECH-062
- Q-015
- Q-016

## References / Source Fragments

- `docs/processed/legacy_tree/docs/architecture/e3.md`
- `docs/processed/legacy_tree/architecture/E3.md`
- `docs/thoughts/2026-02-15_basal_ganglia.md`
- `docs/thoughts/2026-02-15_basal_ganglia_commit_gating_control_plane_axes.md`
- `docs/thoughts/2026-02-18_commitment_as_layered_eligibility_filters.md`
- `docs/thoughts/2026-02-19_basal_ganglia_evolutionary_conservation_pull.md`
